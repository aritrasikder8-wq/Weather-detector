from flask import Flask, render_template_string, request
import requests

app = Flask(__name__)

MAIN_PAGE_HTML = '''
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Detector</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
            text-align: center;
            max-width: 450px;
            width: 100%;
        }
        .logo { font-size: 3rem; margin-bottom: 10px; }
        h1 { color: #333; margin-bottom: 10px; }
        .subtitle { color: #666; margin-bottom: 30px; }
        input[type="text"] {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid #e1e5e9;
            border-radius: 50px;
            font-size: 1rem;
            margin-bottom: 20px;
        }
        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 50px;
            font-size: 1.1rem;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo">üå§Ô∏è</div>
        <h1>Weather Detector</h1>
        <p class="subtitle">Get weather information for any city</p>
        <form action="/weather" method="POST">
            <input type="text" name="city" placeholder="üåç Enter city name..." required>
            <button type="submit" class="btn">Get Weather</button>
        </form>
    </div>
</body>
</html>
'''

RESULTS_PAGE_HTML = '''
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Results</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
            text-align: center;
            max-width: 500px;
            width: 100%;
        }
        .weather-card {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            border-radius: 20px;
            padding: 30px;
            margin: 20px 0;
        }
        .back-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            text-decoration: none;
            padding: 12px 25px;
            border-radius: 50px;
            margin-top: 20px;
            display: inline-block;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Weather Results</h1>
        {% if error %}
            <div style="background: #ff7675; color: white; padding: 20px; border-radius: 15px; margin: 20px 0;">
                <h3>‚ö†Ô∏è {{ error }}</h3>
            </div>
        {% endif %}
        
        {% if weather %}
            <div class="weather-card">
                <div style="font-size: 4rem; margin: 10px 0;">{{ weather.emoji }}</div>
                <div style="font-size: 2rem; margin-bottom: 10px;">{{ weather.city }}</div>
                <div style="font-size: 3.5rem; margin: 10px 0;">{{ weather.temperature }}¬∞C</div>
                <div style="font-size: 1.3rem; margin-bottom: 20px;">{{ weather.description }}</div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px;">
                    <div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 15px;">
                        <div>üíß Humidity</div>
                        <div style="font-size: 1.5rem;">{{ weather.humidity }}%</div>
                    </div>
                    <div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 15px;">
                        <div>üí® Wind</div>
                        <div style="font-size: 1.5rem;">{{ weather.wind_speed }} m/s</div>
                    </div>
                </div>
            </div>
        {% endif %}
        
        <a href="/" class="back-btn">‚Üê Check Another City</a>
    </div>
</body>
</html>
'''

@app.route('/')
def home():
    return render_template_string(MAIN_PAGE_HTML)

@app.route('/weather', methods=['POST'])
def get_weather():
    city = request.form['city']
    
    try:
        # Using wttr.in - NO API KEY NEEDED
        url = f"http://wttr.in/{city}?format=j1"
        response = requests.get(url)
        
        if response.status_code == 200:
            data = response.json()
            current = data['current_condition'][0]
            
            weather_info = {
                'city': city.title(),
                'temperature': current['temp_C'],
                'description': current['weatherDesc'][0]['value'],
                'humidity': current['humidity'],
                'wind_speed': current['windspeedKmph'],
                'emoji': get_weather_emoji(current['weatherCode'])
            }
            return render_template_string(RESULTS_PAGE_HTML, weather=weather_info, error=None)
        else:
            return render_template_string(RESULTS_PAGE_HTML, weather=None, error="City not found! Try another name.")
    
    except Exception as e:
        return render_template_string(RESULTS_PAGE_HTML, weather=None, error="Error fetching weather data. Please try again.")

def get_weather_emoji(weather_code):
    # Simple emoji mapping
    code = str(weather_code)
    if code in ['113']:
        return '‚òÄÔ∏è'  # Sunny
    elif code in ['116', '119', '122']:
        return '‚òÅÔ∏è'  # Cloudy
    elif code in ['176', '263', '266', '293', '296']:
        return 'üåßÔ∏è'  # Rain
    elif code in ['179', '182', '185', '227', '230']:
        return '‚ùÑÔ∏è'  # Snow
    elif code in ['200', '386', '389']:
        return '‚õàÔ∏è'  # Thunder
    else:
        return 'üå§Ô∏è'  # Default

if __name__ == '__main__':
    app.run(debug=True)
